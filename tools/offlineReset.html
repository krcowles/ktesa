<!DOCTYPE html>
<html lang="en-us">
<head>
    <title>Reset Offline Storage</title>
    <meta charset="utf-8" />
    <!-- if search engine keys are desired, 
        use: <meta name="keywords" content="key1, key2, .." -->
    <meta name="description" content="Clear Cache/Worker" />
    <meta name="author" content="Ken Cowles" />
    <meta name="robots" content="nofollow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>

<div>This page is a tool to clear cache and uninstall the service worker
    on a mobile browser. Access via https://nmhikes.com/tools/clearCache
</div>
<script type="text/javascript">
    var msg = '';
    async function deleteNamedCache(cacheName) {
        if ('caches' in window) {
            try {
                const wasDeleted = await caches.delete(cacheName);
                if (wasDeleted) {
                    msg += `Cache "${cacheName}" successfully deleted.`
                    console.log(`Cache "${cacheName}" successfully deleted.`);
                } else {
                    msg += `Cache "${cacheName}" not found.`
                    console.log(`Cache "${cacheName}" not found.`);
                }
                return wasDeleted;
            } catch (error) {
                msg += `Error deleting cache "${cacheName}":` + error;
                console.error(`Error deleting cache "${cacheName}":`, error);
                throw error;
            }
        } else {
            console.warn("Cache API not supported in this environment.");
            return false;
        }
    }
    navigator.serviceWorker.getRegistrations()
    .then( async function(registrations) { 
        var i = 0;
        for(let registration of registrations) {
            i++;
            // This code won't execute when there are no registrations
            if (i === 1) { // In case of multiple service_workers 
                await registration.unregister();
                if (typeof msg !== 'undefined') {
                    msg += "Unregistered service worker\n";
                }
                await deleteNamedCache("offline");
                localStorage.removeItem('mapnames');
                alert(msg);
            }
        }
    }); 
</script>

</body>
</html>